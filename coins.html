<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Coins</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial;
  background:#0b1220;
  color:#fff;
}
.search{
  padding:10px;
}
.search input{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:none;
  outline:none;
}
.coin{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px;
  border-bottom:1px solid #1b2a5a;
  cursor:pointer;
}
.coin-left{
  display:flex;
  gap:10px;
  align-items:center;
}
.coin img{
  width:26px;
  height:26px;
}
.price.up{color:#2ecc71; animation:flash 0.4s}
.price.down{color:#e74c3c; animation:flash 0.4s}

@keyframes flash{
  from{opacity:0.3}
  to{opacity:1}
}

.actions{
  display:none;
  background:#121c3b;
  padding:10px;
}
.actions button{
  width:100%;
  margin:5px 0;
  padding:8px;
  border:none;
  border-radius:6px;
  background:#1b2a5a;
  color:#fff;
}
</style>
</head>

<body>

<div class="search">
  <input id="search" placeholder="Search coin...">
</div>

<div id="coinList"></div>

<script>
let lastPrice = {};
let allCoins = [];

// Load 300+ coins
async function fetchCoins(){
  const url =
   "https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=300&page=1&sparkline=false";
  const res = await fetch(url);
  allCoins = await res.json();
  renderCoins(allCoins.slice(0,10)); // default 10
}

function renderCoins(data){
  const list = document.getElementById("coinList");
  list.innerHTML = "";

  data.forEach(c=>{
    let dir = "";
    if(lastPrice[c.id]){
      dir = c.current_price > lastPrice[c.id] ? "up" : "down";
    }
    lastPrice[c.id] = c.current_price;

    const div = document.createElement("div");
    div.innerHTML = `
      <div class="coin" onclick="toggle('${c.id}')">
        <div class="coin-left">
          <img src="${c.image}">
          <div>
            <strong>${c.symbol.toUpperCase()}</strong><br>
            <small>${c.name}</small>
          </div>
        </div>
        <div class="price ${dir}">$${c.current_price}</div>
      </div>

      <div class="actions" id="a_${c.id}">
        <button>Deposit</button>
        <button>Withdraw</button>
        <button>Transfer</button>
        <button>Trade</button>
      </div>
    `;
    list.appendChild(div);
  });
}

function toggle(id){
  const el = document.getElementById("a_"+id);
  el.style.display = el.style.display==="block"?"none":"block";
}

document.getElementById("search").oninput = e=>{
  const v = e.target.value.toLowerCase();
  if(!v){
    renderCoins(allCoins.slice(0,10));
    return;
  }
  const filtered = allCoins.filter(c =>
    c.name.toLowerCase().includes(v) ||
    c.symbol.toLowerCase().includes(v)
  );
  renderCoins(filtered);
};

fetchCoins();
setInterval(fetchCoins, 15000);
</script>

</body>
</html>
