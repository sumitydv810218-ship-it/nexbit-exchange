<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Nexbit Exchange</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;background:#0b0f1a;color:#fff;font-family:Arial}
.box{max-width:420px;margin:20px auto;padding:20px;background:#121a2f;border-radius:12px}
input,button,select{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:none}
button{background:#2d6cff;color:#fff}
.coin{display:flex;justify-content:space-between;padding:10px;background:#1a2445;margin:5px 0;border-radius:8px}
.hidden{display:none}
.search{background:#0b0f1a;color:#fff;border:1px solid #333}
</style>
</head>

<body>

<div class="box" id="loginBox">
  <h3>Login</h3>
  <input id="email" placeholder="Email">
  <input id="pass" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<div class="box hidden" id="app">
  <h3>Assets</h3>

  <input class="search" placeholder="Search coin..." oninput="filterCoins(this.value)">

  <div id="coins"></div>

  <hr>

  <h4>Deposit</h4>
  <select id="dcoin"></select>
  <input id="damount" placeholder="Amount">
  <button onclick="deposit()">Submit Deposit</button>

  <hr>

  <h4>Withdraw</h4>
  <select id="wcoin"></select>
  <input id="wamount" placeholder="Amount">
  <input id="waddress" placeholder="Wallet Address">
  <button onclick="withdraw()">Submit Withdraw</button>

  <p id="msg"></p>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, addDoc, collection, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDR2XkDg6UA19ZdjSqK3fCZiUCNn0c3Me8",
  authDomain: "nexbit-exchange.firebaseapp.com",
  projectId: "nexbit-exchange"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const COINS = ["BTC","ETH","USDT","BNB","SOL","XRP","DOGE","TRX","AVAX","SHIB","DOT","MATIC","LTC","UNI","ICP","NEAR","FIL","ARB","OP","APT"]; // extend to 200+

window.login = ()=>signInWithEmailAndPassword(auth,email.value,pass.value);

onAuthStateChanged(auth, async user=>{
  if(!user) return;
  loginBox.classList.add("hidden");
  app.classList.remove("hidden");

  const ref = doc(db,"users",user.uid);
  const snap = await getDoc(ref);
  if(!snap.exists()){
    const bal={}; COINS.forEach(c=>bal[c]=0);
    await setDoc(ref,{ email:user.email, balances:bal });
  }
  renderCoins();
});

async function renderCoins(){
  const snap = await getDoc(doc(db,"users",auth.currentUser.uid));
  const b = snap.data().balances;
  coins.innerHTML="";
  dcoin.innerHTML="";
  wcoin.innerHTML="";
  COINS.forEach(c=>{
    coins.innerHTML+=`<div class="coin"><span>${c}</span><b>${b[c]||0}</b></div>`;
    dcoin.innerHTML+=`<option>${c}</option>`;
    wcoin.innerHTML+=`<option>${c}</option>`;
  });
}

window.filterCoins = q=>{
  [...coins.children].forEach(d=>{
    d.style.display = d.innerText.toLowerCase().includes(q.toLowerCase()) ? "flex":"none";
  });
}

window.deposit = async ()=>{
  await addDoc(collection(db,"deposits"),{
    uid:auth.currentUser.uid,
    coin:dcoin.value,
    amount:Number(damount.value),
    status:"pending",
    time:serverTimestamp()
  });
  msg.innerText="Deposit pending approval";
}

window.withdraw = async ()=>{
  await addDoc(collection(db,"withdrawals"),{
    uid:auth.currentUser.uid,
    coin:wcoin.value,
    amount:Number(wamount.value),
    address:waddress.value,
    status:"pending",
    time:serverTimestamp()
  });
  msg.innerText="Withdraw request submitted";
}
</script>
</body>
</html>
