<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Nexbit Assets</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;background:#0b0f1a;color:#fff;font-family:Arial}
.box{max-width:400px;margin:40px auto;padding:20px;background:#121a2f;border-radius:12px}
input,button{width:100%;padding:12px;margin:8px 0;border-radius:8px;border:none}
button{background:#2d6cff;color:#fff}
.hidden{display:none}
</style>
</head>

<body>

<div class="box" id="loginBox">
  <h2>Login</h2>
  <input id="email" placeholder="Email">
  <input id="pass" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<div class="box hidden" id="app">
  <h2>Assets Overview</h2>
  <p>Balance: $<b id="bal">0.00</b></p>
  <button onclick="deposit()">Deposit</button>
  <button>Withdraw</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDR2XkDg6UA19ZdjSqK3fCZiUCNn0c3Me8",
  authDomain: "nexbit-exchange.firebaseapp.com",
  projectId: "nexbit-exchange",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window.login = async ()=>{
  await signInWithEmailAndPassword(auth,email.value,pass.value);
};

onAuthStateChanged(auth, async user=>{
  if(!user) return;
  loginBox.classList.add("hidden");
  app.classList.remove("hidden");

  const ref = doc(db,"users",user.uid);
  const snap = await getDoc(ref);
  if(!snap.exists()){
    await setDoc(ref,{ balance:0 });
    bal.innerText="0.00";
  } else {
    bal.innerText = snap.data().balance.toFixed(2);
  }
});

window.deposit = async ()=>{
  let amt = prompt("Enter deposit amount");
  if(!amt || isNaN(amt)) return;

  const user = auth.currentUser;
  const ref = doc(db,"users",user.uid);
  const snap = await getDoc(ref);
  let newBal = snap.data().balance + parseFloat(amt);

  await updateDoc(ref,{ balance:newBal });
  bal.innerText = newBal.toFixed(2);
};
</script>

</body>
</html>
